/**
 * X-Ray by Amur
 * https://github.com/AmurKhoyetsyan/X-Ray
 */

class XRay{constructor(e){this.elem=e,this.state={magnifyingGlassBackground:"transparent",typeShow:"circle",beyondTheBoundary:!0,diameter:150,magnifyingGlassResponsive:!0,cursor:!1,responsiveDiameter:[{size:1199,diameter:130},{size:991,diameter:100},{size:767,diameter:80},{size:575,diameter:50}]}}setState(e){for(let t in e)e.hasOwnProperty(t)&&(this.state[t]=e[t])}dNone(e){for(let t=0;t<e.length;t++)e[t].style.display="none"}addPhotos(e,t,s){let a=document.createElement("div");a.classList.add("x-ray-photo-parent"),this.state.cursor||a.classList.add("cursor-none");let i=document.createElement("img");i.classList.add("x-ray-first-photo"),i.src=e[0].getAttribute("src");let l=document.createElement("div");l.classList.add("x-ray-last-photo"),l.classList.add("transform");let{responsiveDiameter:n,diameter:o}=this.state,p=this.getMaxResponsiveDiameter(n),r=this.matchesWindow(n);if(this.state.magnifyingGlassResponsive?window.matchMedia(`(min-width: ${p+1}px)`).matches?(l.style.width=`${o}px`,l.style.height=`${o}px`):(l.style.width=`${r}px`,l.style.height=`${r}px`):(l.style.width=`${o}px`,l.style.height=`${o}px`),"magnifyingGlass"===this.state.typeShow){let e=document.createElement("div");e.classList.add("magnifyingGlass"),l.appendChild(e)}l.style.backgroundColor=this.state.magnifyingGlassBackground;let h=document.createElement("div");h.classList.add("x-ray-last-photo-img-parent");let d=document.createElement("img");return d.classList.add("x-ray-last-photo-img"),d.classList.add("transform"),d.src=e[1].getAttribute("src"),d.style.width=`${t}px`,d.style.height=`${s}px`,h.appendChild(d),l.appendChild(h),this.dNone(e),a.appendChild(i),a.appendChild(l),a}getMaxResponsiveDiameter(e){let t=e[0].size;for(let s=0;s<e.length;s++)e[s].size>t&&(t=e[s].size);return t}matchesWindow(e){let t=e[0].size;for(let s=0;s<e.length;s++)window.matchMedia(`(max-width: ${e[s].size}px)`).matches&&(t=e[s].diameter);return t}windowResize(e){let t=e.getElementsByClassName("x-ray-first-photo")[0],s=e.getElementsByClassName("x-ray-last-photo")[0],a=s.getElementsByClassName("x-ray-last-photo-img")[0];a.style.width=`${t.clientWidth}px`,a.style.height=`${t.clientHeight}px`;let{responsiveDiameter:i,diameter:l}=this.state,n=this.getMaxResponsiveDiameter(i),o=this.matchesWindow(i);this.state.magnifyingGlassResponsive?window.matchMedia(`(min-width: ${n+1}px)`).matches?(s.style.width=`${l}px`,s.style.height=`${l}px`):(s.style.width=`${o}px`,s.style.height=`${o}px`):(s.style.width=`${l}px`,s.style.height=`${l}px`)}trueHover(e,t){let s=t.getElementsByClassName("x-ray-last-photo")[0],a=s.getElementsByTagName("img")[0],{width:i,height:l}=t.getBoundingClientRect(),n=t.offsetLeft,o=t.offsetTop,p=o,r=o+l,h=n,d=n+i,m=s.clientHeight/2,g=s.clientWidth/2;e.pageY>=p&&e.pageY<=r?(s.style.top=`${e.pageY-(o+m)}px`,a.style.top=`${-e.pageY+(o+m)}px`):e.pageY<p?(s.style.top=`${p-(o+m)}px`,a.style.top=`${p-(o-m)}px`):e.pageY>r&&(s.style.top=`${r-(o+m)}px`,a.style.top=`${-r+(o+m)}px`),e.pageX>=h&&e.pageX<=d?(s.style.left=`${e.pageX-(n+g)}px`,a.style.left=`${-e.pageX+(n+g)}px`):e.pageX<h?(s.style.left=`${h-(n+g)}px`,a.style.left=`${h-(n-g)}px`):e.pageX>d&&(s.style.left=`${d-(n+g)}px`,a.style.left=`${-d+(n+g)}px`)}falseHover(e,t){let s=t.getElementsByClassName("x-ray-last-photo")[0],a=s.getElementsByTagName("img")[0],{width:i,height:l}=t.getBoundingClientRect(),n=t.offsetLeft,o=t.offsetTop,p=o,r=o+l,h=n,d=n+i,m=s.clientHeight/2,g=s.clientWidth/2;e.pageY>=p+m&&e.pageY<=r-m?(s.style.top=`${e.pageY-(o+m)}px`,a.style.top=`${-e.pageY+(o+m)}px`):e.pageY<p+m?(s.style.top=`${p-o}px`,a.style.top=`${p-o}px`):e.pageY>r-m&&(s.style.top=`${r-(o+2*m)}px`,a.style.top=`${-r+(o+2*m)}px`),e.pageX>=h+g&&e.pageX<=d-g?(s.style.left=`${e.pageX-(n+g)}px`,a.style.left=`${-e.pageX+(n+g)}px`):e.pageX<h+g?(s.style.left=`${h-n}px`,a.style.left=`${h-n}px`):e.pageX>d-g&&(s.style.left=`${d-(n+2*g)}px`,a.style.left=`${-d+(n+2*g)}px`)}removeTransform(e){let t=e.getElementsByClassName("x-ray-last-photo")[0],s=e.getElementsByClassName("x-ray-last-photo-img")[0];t.classList.contains("transform")&&t.classList.remove("transform"),s.classList.contains("transform")&&s.classList.remove("transform")}createXRay(e){let t=this,s=e.getElementsByTagName("img"),a=s[0].clientWidth,i=s[0].clientHeight,l=t.addPhotos(s,a,i);e.appendChild(l),window.onmousemove=function(s){e.onmousemove=function(){t.removeTransform(e),t.state.beyondTheBoundary?t.trueHover(s,e):t.falseHover(s,e)}},window.onresize=function(s){t.windowResize(e)}}run(e={}){if(Object.keys(e).length>0&&this.setState(e),this.elem.length>0)for(let e=0;e<this.elem.length;e++)this.createXRay(this.elem[e])}}