/**
 * X-Ray by Amur
 * https://github.com/AmurKhoyetsyan/X-Ray
 */

class XRay{constructor(e){this.elem=e,this.state={backgroundColor:"transparent",type:"circle",beyond:!0,diameter:150,responsive:!0,cursor:!1,resize:[{screen:1199,diameter:130},{screen:991,diameter:100},{screen:767,diameter:80},{screen:575,diameter:50}]}}setState(e){for(let t in e)e.hasOwnProperty(t)&&(this.state[t]=e[t])}dNone(e){for(let t=0;t<e.length;t++)e[t].style.display="none"}addPhotos(e,t,s){let a=document.createElement("div");a.classList.add("x-ray-photo-parent"),this.state.cursor||a.classList.add("cursor-none");let l=document.createElement("img");l.classList.add("x-ray-first-photo"),l.src=e[0].getAttribute("src");let i=document.createElement("div");i.classList.add("x-ray-last-photo"),i.classList.add("transform");let{resize:o,diameter:n}=this.state,p=this.getMaxresize(o),r=this.matchesWindow(o);if(this.state.responsive?window.matchMedia(`(min-width: ${p+1}px)`).matches?(i.style.width=`${r>n?r:n}px`,i.style.height=`${r>n?r:n}px`):(i.style.width=`${r}px`,i.style.height=`${r}px`):(i.style.width=`${n}px`,i.style.height=`${n}px`),"magnifyingGlass"===this.state.type){let e=document.createElement("div");e.classList.add("magnifyingGlass"),i.appendChild(e)}i.style.backgroundColor=this.state.backgroundColor;let h=document.createElement("div");h.classList.add("x-ray-last-photo-img-parent");let d=document.createElement("img");return d.classList.add("x-ray-last-photo-img"),d.classList.add("transform"),d.src=e[1].getAttribute("src"),d.style.width=`${t}px`,d.style.height=`${s}px`,h.appendChild(d),i.appendChild(h),this.dNone(e),a.appendChild(l),a.appendChild(i),a}getMaxresize(e){let t=e[0].screen;for(let s=0;s<e.length;s++)e[s].screen>t&&(t=e[s].screen);return t}matchesWindow(e){let t=e[0].diameter;for(let s=0;s<e.length;s++)window.matchMedia(`(max-width: ${e[s].screen}px)`).matches&&(t=e[s].diameter);return t}windowResize(e){let t=e.getElementsByClassName("x-ray-first-photo")[0],s=e.getElementsByClassName("x-ray-last-photo")[0],a=s.getElementsByClassName("x-ray-last-photo-img")[0];a.style.width=`${t.clientWidth}px`,a.style.height=`${t.clientHeight}px`;let{resize:l,diameter:i}=this.state,o=this.getMaxresize(l),n=this.matchesWindow(l);this.state.responsive?window.matchMedia(`(min-width: ${o+1}px)`).matches?(s.style.width=`${n>i?n:i}px`,s.style.height=`${n>i?n:i}px`):(s.style.width=`${n}px`,s.style.height=`${n}px`):(s.style.width=`${i}px`,s.style.height=`${i}px`)}trueHover(e,t){let s=t.getElementsByClassName("x-ray-last-photo")[0],a=s.getElementsByTagName("img")[0],{width:l,height:i}=t.getBoundingClientRect(),o=t.offsetLeft,n=t.offsetTop,p=n,r=n+i,h=o,d=o+l,m=s.clientHeight/2,g=s.clientWidth/2;e.pageY>=p&&e.pageY<=r?(s.style.top=`${e.pageY-(n+m)}px`,a.style.top=`${-e.pageY+(n+m)}px`):e.pageY<p?(s.style.top=`${p-(n+m)}px`,a.style.top=`${p-(n-m)}px`):e.pageY>r&&(s.style.top=`${r-(n+m)}px`,a.style.top=`${-r+(n+m)}px`),e.pageX>=h&&e.pageX<=d?(s.style.left=`${e.pageX-(o+g)}px`,a.style.left=`${-e.pageX+(o+g)}px`):e.pageX<h?(s.style.left=`${h-(o+g)}px`,a.style.left=`${h-(o-g)}px`):e.pageX>d&&(s.style.left=`${d-(o+g)}px`,a.style.left=`${-d+(o+g)}px`)}falseHover(e,t){let s=t.getElementsByClassName("x-ray-last-photo")[0],a=s.getElementsByTagName("img")[0],{width:l,height:i}=t.getBoundingClientRect(),o=t.offsetLeft,n=t.offsetTop,p=n,r=n+i,h=o,d=o+l,m=s.clientHeight/2,g=s.clientWidth/2;e.pageY>=p+m&&e.pageY<=r-m?(s.style.top=`${e.pageY-(n+m)}px`,a.style.top=`${-e.pageY+(n+m)}px`):e.pageY<p+m?(s.style.top=`${p-n}px`,a.style.top=`${p-n}px`):e.pageY>r-m&&(s.style.top=`${r-(n+2*m)}px`,a.style.top=`${-r+(n+2*m)}px`),e.pageX>=h+g&&e.pageX<=d-g?(s.style.left=`${e.pageX-(o+g)}px`,a.style.left=`${-e.pageX+(o+g)}px`):e.pageX<h+g?(s.style.left=`${h-o}px`,a.style.left=`${h-o}px`):e.pageX>d-g&&(s.style.left=`${d-(o+2*g)}px`,a.style.left=`${-d+(o+2*g)}px`)}removeTransform(e){let t=e.getElementsByClassName("x-ray-last-photo")[0],s=e.getElementsByClassName("x-ray-last-photo-img")[0];t.classList.contains("transform")&&t.classList.remove("transform"),s.classList.contains("transform")&&s.classList.remove("transform")}createXRay(e){let t=this,s=e.getElementsByTagName("img"),a=s[0].clientWidth,l=s[0].clientHeight,i=t.addPhotos(s,a,l);e.appendChild(i),window.onmousemove=function(s){e.onmousemove=function(){t.removeTransform(e),t.state.beyond?t.trueHover(s,e):t.falseHover(s,e)}},window.onresize=function(s){t.windowResize(e)}}run(e={}){if(Object.keys(e).length>0&&this.setState(e),this.elem.length>0)for(let e=0;e<this.elem.length;e++)this.createXRay(this.elem[e])}}